<!DOCTYPE html>
<html>

<head>
	<link href="../css/forms.css" type="text/css" rel="stylesheet">
	<link href="../css/index.css" type="text/css" rel="stylesheet">
	<link href="../css/radioNew.css" type="text/css" rel="stylesheet">

	<style type="text/css">
		#modalWO {
			display: block;
			position: absolute;
			top: 0;
			left: 0;
			max-height: 100%;
		}
		#fName {
			margin-bottom: 5px;
		}

		.nextB {
			position: relative;
		  	display: block;
		    padding: 19px 39px 18px 39px;
		    border-radius: 4px;
		    color: #FFF;
		    margin: 0 auto;
		    background: #1a8bbc;
		    font-size: 18px;
		    text-align: center;
		    font-style: normal;
		    width: 100%;
		    border: 1px solid #146F96;
		    border-width: 1px 1px 3px;
		    margin-bottom: 10px;
		    cursor: pointer;
		}

		.nextB:hover {
			background: #146F96;
			cursor: pointer;
		}

		#next, #send, #condO, #typeO, #timeBackQ, #loadNext {
			display: none;
		}




	</style>

</head>

<body>

  <div class="form-style-5 form" id="modalWO">
		<span id="closeWO" class="close">&times;</span>
	  <form id="WOForm" onsubmit="formSubmit(event, 'WOForm', 'modalWO', 'cbWO')">
	  	<div id="userInfo">
		    <fieldset>
		      <legend><span class="number">1</span> User Infomation</legend>
		      <input type="text" name="firstName" placeholder="Your Name *" id="fName">
		      <input type="text" name="lastName" placeholder="Last Name *">
		    </fieldset>
		</div>
	    <fieldset>
	      <legend><span class="number">2</span> Water Service, O+R</legend>
	      <div id="intro">
		      <label class="question">Did you experience a cut in the water supply?</label>
		      <div class="inputGroup">
		      	<input id="waterCutY" name="waterCut" type="radio" value="yes" onchange="smartFormIntro()"/>
		      	<label for="waterCutY">Yes</label>
		      </div>
		      <div class="inputGroup"> 
		      	<input id="waterCutN" name="waterCut" type="radio" value="no" onchange="smartFormIntro()"/>
		      	<label for="waterCutN">No</label>
		      </div>
		      <br>
		      <div id="typeO">
			      <label class="question">What is the problem with the water supply? (Select all that apply)</label>
			      <div class="inputGroup">
			      	<input id="reductionPressure" name="reductionPressure" type="checkbox" onchange="smartFormIntro()" value="yes">
			      	<label for="reductionPressure">Reduction in water pressure</label>
			      </div>
			      <div class="inputGroup">
			      	<input id="reductionQuality" name="reductionQuality" type="checkbox" onchange="smartFormIntro()" value="yes">
			      	<label for="reductionQuality">Lower water quality</label>
			      </div>
			      <br>
		  	  </div>
		      <button id="loadNext" type="button" class="nextB">Next</button>
	  		</div>
	  	<div id="condO">
	      <label class="question">In what ways is the water of low quality? (Select all that apply)</label>
	      <div class="inputGroup">
	      	<input id="taste" name="taste" type="checkbox" onchange="smartForm()" value="yes">
	      	<label for="taste">Taste</label>
	      </div>
	      <div class="inputGroup">
	      	<input id="smell" name="smell" type="checkbox" onchange="smartForm()" value="yes">
	      	<label for="smell">Smell</label>
	      </div>
	      <div class="inputGroup">
	      	<input id="appearance" name="appearance" type="checkbox" onchange="smartForm()" value="yes">
	      	<label for="appearance">Appearance</label>
	      </div>
	      <textarea rows="2" placeholder="If you like, tell us more about the water quality here" maxlength="300" name="comments"></textarea>
	      <br>
	  	</div>
	  	<div id="next">
	      <label class="question"> At what time was this noticed? </label>
	      <input type="time" name="startTime" id="startTime" onchange="smartForm()">
	      <label class="question"> Is your water supply performing normally now? </label>
	      <div class="inputGroup">
	        <input id="backyetY" name="backyet" type="radio" onchange="smartForm()"/ value="yes">
	        <label for="backyetY">Yes</label>
	      </div>
	      <div class="inputGroup">
	        <input id="backyetN" name="backyet" type="radio" onchange="smartForm()"/ value="no">
	        <label for="backyetN">No</label>
	      </div>
	      <br>
	      <div id="timeBackQ">
		  	<label class="question">At what time did the water supply perform normally again?</label>
		    <input type="time" name="timeBack" id="timeBack" onchange="smartForm()"> 
	  	  </div>
	  	</div>
	  	<input type="hidden" name="ID" value="">
	  	<input type="hidden" name="timestamp" id="timestamp" value="">

	     </fieldset>
	  		<input type="submit" value="Submit" id="send"/>
	  </form>
	</div>

	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script>

		var userInfo = document.getElementById('userInfo');
		var intro = document.getElementById('intro');
		var next = document.getElementById('next');
		var typeO = document.getElementById('typeO');
		var condO = document.getElementById('condO');
		var send = document.getElementById('send');
		var loadNext = document.getElementById('loadNext');
		var waterCutY = document.getElementById('waterCutY');
		var waterCutN = document.getElementById('waterCutN');
		var reductionPressure = document.getElementById('reductionPressure');
		var reductionQuality = document.getElementById('reductionQuality');
		var taste = document.getElementById('taste');
		var smell = document.getElementById('smell');
		var appearance = document.getElementById('appearance');

		var backyetY = document.getElementById('backyetY');
		var backyetN = document.getElementById('backyetN');

		var timeBack = document.getElementById('timeBack');

		function smartFormIntro() {
			if (waterCutY.checked) {
				typeO.style.display = "none";
				reductionPressure.checked = false;
				reductionQuality.checked = false;
				loadNext.style.display = "block";
			}
			else if (waterCutN.checked) {
				typeO.style.display = "block";
				if ( (reductionPressure.checked) || (reductionQuality.checked) ) {
					loadNext.style.display = "block";
				}
				else {
					loadNext.style.display = "none";
				}
			}
		}

		function smartForm() {
			if (backyetY.checked) {
				timeBackQ.style.display = "block";
			}
			else if (backyetN.checked) {
				timeBackQ.style.display = "none";
				timeBack.valueAsDate = null;
			}
			if ( (((condO.style.display) == "block") && (taste.checked || smell.checked || appearance.checked) ) || ((condO.style.display) == "none")) {
				if (startTime.valueAsDate != null) {
					if ((backyetY.checked) && (timeBack.valueAsDate != null)) {
						send.style.display = "block";
					}
					else if (backyetN.checked) {
						send.style.display = "block";
					}
					else {
						send.style.display = "none";
					}
				}
				else {
					send.style.display = "none";
				}
			}
			else {
				send.style.display = "none";
			}
		}

		loadNext.onclick = function () {
			userInfo.style.display = "none";
			intro.style.display = "none";
			next.style.display = "block";
			if (reductionQuality.checked) {
				condO.style.display = "block";
			}
			else {
				condO.style.display = "none";
			}
		}

		function formSubmit(event, formID, modalID) {
		    event.preventDefault();

		    
		    var form = $('#'+formID);
		    var id = document.getElementById(formID).ID;
		    id.value = Math.floor((Math.random() * 100000000) + 1);
		    var timestamp = document.getElementById(formID).timestamp;
		    timestamp.value = Date();

		    //remove all inputs with no values
			form.find(":input").filter(function(){ return !this.value; }).attr("disabled", "disabled");

		    formSend(form);

		    /*var modal = document.getElementById(modalID);
		    modal.style.display = "none";*/

		}

		function formSend(form) {
		    $.ajax({
		       type: "POST",
		       url: "https://xdfz4o3cjk.execute-api.eu-west-2.amazonaws.com/live/networkingwater",
		       data: form.serialize(),
		       dataType: 'x-www-form-urlencoded',
		       contentType: 'application/x-www-form-urlencoded',
		       success: function(data)
		       {
		           alert("Data Submitted!");
		           console.log('submit successful')
		       }
		    });
		}


	</script>


</body>

</html>